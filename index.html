<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script>

    function calculate() {

      var bgTarget = document.getElementById("bg-target").value;
      var bgCurrent = document.getElementById("bg-current").value;
      var corrFactor = document.getElementById("corr-factor").value;
      var corrDose = ((bgCurrent - bgTarget)/corrFactor);
      document.getElementById("corr-dose").value = corrDose;

      var carbTotal = document.getElementById("carb-total").value;
      var carbRatio = document.getElementById("ins-carb-ratio").value;
      var carbDose = carbTotal / carbRatio;
      document.getElementById("carb-dose").value = carbDose;

      document.getElementById("total-dose").value = corrDose + carbDose;

      // what ghappens if we round up?
      ceilDose = Math.ceil(corrDose + carbDose)
      ceilCorrDose = ceilDose - carbDose;
      ceilBG = bgCurrent-(corrFactor*ceilCorrDose);
      document.getElementById("ceil-glucose").innerHTML = ceilDose + " units of insulin, estimated blood glucose level of " + ceilBG.toPrecision(2)

      // what ghappens if we round down?
      floorDose = Math.floor(corrDose + carbDose)
      floorCorrDose = floorDose - carbDose;
      floorBG = bgCurrent-(corrFactor*floorCorrDose);

      document.getElementById("floor-glucose").innerHTML = floorDose + " units of insulin, estimated blood glucose level of " + floorBG.toPrecision(2)



    }


    </script>
    <title>Insulin Calculator</title>
  </head>
  <body class="bg-light">
    <div class="container">
      <h3>Insulin Calculator</h3>

      <div class="row">
        <div class="col-md-6 order-md-6 mb-6">
          <label for="bg-target">Blood glucose target</label>
          <input type="text" class="form-control" id="bg-target" placeholder="" required="true" value="7" onblur="calculate()">
          <small class="text-muted">Target blood glucose level in mmol/L</small>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 order-md-6 mb-6">
          <label for="bg-current">Current blood glucose level</label>
          <input type="text" class="form-control" id="bg-current" placeholder="" required="true" onblur="calculate()">
          <small class="text-muted">Current blood glucose level in mmol/L</small>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 order-md-6 mb-6">
          <label for="corr-factor">Correction factor</label>
          <input type="text" class="form-control" id="corr-factor" placeholder="3" required="true" value="3" onblur="calculate()">
          <small class="text-muted">How much will 1 unit of insulin reduce the blood glucose level in mmol/L?</small>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 order-md-6 mb-6">
          <label for="corr-dose">Correction dose</label>
          <input type="text" class="form-control" id="corr-dose" placeholder="" readonly="true">
          <small class="text-muted">The amount of insulin required to lower blood glucose level to the target level</small>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 order-md-6 mb-6">
          <label for="carb-total">Carb total</label>
          <input type="text" class="form-control" id="carb-total" placeholder="" required="true" value="0" onblur="calculate()">
          <small class="text-muted">The amount of carbohydrate in the meal in grams</small>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 order-md-6 mb-6">
          <label for="ins-carb-ratio">Insulin : Carb ratio</label>
          <input type="text" class="form-control" id="ins-carb-ratio" placeholder="" required="true" value="10" onblur="calculate()">
          <small class="text-muted">The amount of carbohydrate that 1 unit of insulin will dispose</small>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 order-md-6 mb-6">
          <label for="carb-dose">Carb coverage dose</label>
          <input type="text" class="form-control" id="carb-dose" placeholder="" readonly="true" required="true" >
          <small class="text-muted">The amount of insulin required to dispose of the mealtime carbohydrate.</small>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 order-md-6 mb-6">
          <label for="total-dose">Total Insulin</label>
          <input type="text" class="form-control" id="total-dose" placeholder="" readonly="true" required="true" >
        </div>
      </div>

      <div class="row">
        <div id="ceil-glucose" class="col-md-6 order-md-6 mb-6">
        </div>
      </div>

      <div class="row">
        <div id="floor-glucose" class="col-md-6 order-md-6 mb-6">
        </div>
      </div>


    </div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>
